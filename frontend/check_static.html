<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test { margin: 15px 0; padding: 15px; border-radius: 4px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .fix-code { background: #e8f5e9; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ YouTube Analyzer</h1>
        <div id="results"></div>
        
        <div id="recommendations" style="display: none; margin-top: 30px;">
            <h2>üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h2>
            <div id="recommendations-content"></div>
        </div>
    </div>

    <script>
        const tests = [
            {
                name: '–ü—Ä–æ–≤–µ—Ä–∫–∞ app.js',
                urls: [
                    '/app.js',
                    '/frontend/app.js',
                    'http://localhost:8000/app.js',
                    'http://localhost:8000/frontend/app.js'
                ],
                validateContent: (content) => {
                    return content.includes('ApiClient') && content.includes('YouTube Analyzer');
                }
            },
            {
                name: '–ü—Ä–æ–≤–µ—Ä–∫–∞ style.css',
                urls: [
                    '/style.css',
                    '/frontend/style.css',
                    'http://localhost:8000/style.css',
                    'http://localhost:8000/frontend/style.css'
                ],
                validateContent: (content) => {
                    return content.includes('YouTube Analyzer') || content.includes(':root');
                }
            },
            {
                name: '–ü—Ä–æ–≤–µ—Ä–∫–∞ index.html',
                urls: [
                    '/',
                    '/index.html',
                    '/frontend/index.html',
                    'http://localhost:8000/',
                    'http://localhost:8000/index.html'
                ],
                validateContent: (content) => {
                    return content.includes('<!DOCTYPE html>') && content.includes('YouTube');
                }
            }
        ];

        const results = document.getElementById('results');
        const problems = [];

        async function checkFile(test) {
            const div = document.createElement('div');
            div.className = 'test';
            results.appendChild(div);

            let success = false;
            let workingUrl = '';
            let contentInfo = '';

            for (const url of test.urls) {
                try {
                    const response = await fetch(url);
                    const contentType = response.headers.get('content-type') || '';
                    const content = await response.text();

                    if (response.ok) {
                        const isValidContent = test.validateContent(content);
                        
                        if (isValidContent) {
                            success = true;
                            workingUrl = url;
                            contentInfo = `
                                <br>‚úÖ URL: <code>${url}</code>
                                <br>Content-Type: <code>${contentType}</code>
                                <br>–†–∞–∑–º–µ—Ä: ${content.length} –±–∞–π—Ç
                                <br>–ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:
                                <pre>${content.substring(0, 200)}...</pre>
                            `;
                            break;
                        } else {
                            contentInfo += `<br>‚ö†Ô∏è ${url} - –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ`;
                        }
                    } else {
                        contentInfo += `<br>‚ùå ${url} - HTTP ${response.status}`;
                    }
                } catch (error) {
                    contentInfo += `<br>‚ùå ${url} - ${error.message}`;
                }
            }

            if (success) {
                div.className = 'test success';
                div.innerHTML = `<strong>‚úÖ ${test.name}</strong>${contentInfo}`;
            } else {
                div.className = 'test error';
                div.innerHTML = `<strong>‚ùå ${test.name}</strong><br>–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω${contentInfo}`;
                problems.push(test.name);
            }
        }

        async function runTests() {
            results.innerHTML = '<div class="test">‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã...</div>';
            await new Promise(resolve => setTimeout(resolve, 500));
            results.innerHTML = '';

            for (const test of tests) {
                await checkFile(test);
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            const scriptTest = document.createElement('div');
            scriptTest.className = 'test';
            
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å app.js –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
                const script = document.createElement('script');
                script.src = '/app.js';
                
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                    setTimeout(reject, 5000); // –¢–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥
                });

                if (typeof window.ApiClient !== 'undefined') {
                    scriptTest.className = 'test success';
                    scriptTest.innerHTML = '<strong>‚úÖ JavaScript –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</strong>';
                } else {
                    scriptTest.className = 'test warning';
                    scriptTest.innerHTML = '<strong>‚ö†Ô∏è JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ ApiClient –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</strong>';
                }
            } catch (error) {
                scriptTest.className = 'test error';
                scriptTest.innerHTML = '<strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JavaScript</strong><br>' + error.message;
                problems.push('JavaScript execution');
            }
            
            results.appendChild(scriptTest);

            showRecommendations();
        }

        function showRecommendations() {
            if (problems.length === 0) {
                const successDiv = document.createElement('div');
                successDiv.className = 'test success';
                successDiv.innerHTML = `
                    <h3>‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</h3>
                    <p>–ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å—ë –µ—â–µ –∑–∞–≤–∏—Å–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:</p>
                    <ol>
                        <li>–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ JavaScript –æ—à–∏–±–æ–∫</li>
                        <li>–í–∫–ª–∞–¥–∫—É Network (F12) - –≤–æ–∑–º–æ–∂–Ω–æ –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–≤–∏—Å–∞—é—Ç</li>
                        <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –∏–ª–∏ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ</li>
                    </ol>
                `;
                results.appendChild(successDiv);
            } else {
                const recommendationsEl = document.getElementById('recommendations');
                const content = document.getElementById('recommendations-content');
                
                recommendationsEl.style.display = 'block';
                
                let fixes = '<div class="fix-code">';
                fixes += '<h3>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ backend/main.py</h3>';
                fixes += '<p>–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø—É—Ç–µ–π –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:</p>';
                fixes += '<pre>';
                fixes += `# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
frontend_path = Path(__file__).parent.parent / "frontend"
static_path = Path(__file__).parent.parent / "frontend"

# –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ:
from fastapi.staticfiles import StaticFiles

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
@app.get("/app.js")
async def serve_app_js():
    file_path = frontend_path / "app.js"
    if file_path.exists():
        return FileResponse(str(file_path), media_type="application/javascript")
    return JSONResponse({"error": "app.js not found"}, status_code=404)

@app.get("/style.css")
async def serve_style_css():
    file_path = frontend_path / "style.css"
    if file_path.exists():
        return FileResponse(str(file_path), media_type="text/css")
    return JSONResponse({"error": "style.css not found"}, status_code=404)

# –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
app.mount("/", StaticFiles(directory=str(frontend_path), html=True), name="static")`;
                fixes += '</pre></div>';

                fixes += '<div class="fix-code">';
                fixes += '<h3>üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–µ—Ä:</h3>';
                fixes += '<pre>';
                fixes += `cd C:\\youtube-analyzer
python -m http.server 8000 --directory frontend`;
                fixes += '</pre>';
                fixes += '<p>–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Å—Ç–æ–π HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è frontend</p>';
                fixes += '</div>';

                content.innerHTML = fixes;
            }
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤...');
        console.log('window.ApiClient:', typeof window.ApiClient);
        console.log('window.lucide:', typeof window.lucide);

        runTests();

        // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Å–æ–ª–∏
        const consoleBtn = document.createElement('button');
        consoleBtn.textContent = 'üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏';
        consoleBtn.style.cssText = 'margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px;';
        consoleBtn.onclick = () => {
            console.log('=== –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ YouTube Analyzer ===');
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:', Array.from(document.scripts).map(s => s.src));
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏:', Array.from(document.styleSheets).map(s => s.href));
            console.log('window –æ–±—ä–µ–∫—Ç—ã:', Object.keys(window).filter(k => k.includes('Api') || k.includes('lucide')));
            console.log('–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏:', performance.getEntriesByType('resource').filter(r => r.responseStatus >= 400));
        };
        document.querySelector('.container').appendChild(consoleBtn);
    </script>
</body>
</html>