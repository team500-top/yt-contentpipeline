<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Fix Frontend Loading</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .code { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Frontend</h1>
    
    <div id="status"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="testBasic()">1. –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç JS</button>
        <button onclick="testApiClient()">2. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ ApiClient</button>
        <button onclick="forceInit()">3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</button>
    </div>
    
    <div id="results"></div>

    <script>
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        
        function log(msg, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = msg;
            results.appendChild(div);
            console.log(msg);
        }
        
        function testBasic() {
            results.innerHTML = '<h3>–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç JavaScript:</h3>';
            
            try {
                // –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π JS
                log('‚úÖ JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è');
                
                // –¢–µ—Å—Ç 2: DOM –¥–æ—Å—Ç—É–ø–µ–Ω
                if (document.body) {
                    log('‚úÖ DOM –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –¢–µ—Å—Ç 3: Fetch —Ä–∞–±–æ—Ç–∞–µ—Ç
                fetch('/health')
                    .then(r => r.json())
                    .then(data => log('‚úÖ Fetch API —Ä–∞–±–æ—Ç–∞–µ—Ç: ' + JSON.stringify(data)))
                    .catch(e => log('‚ùå –û—à–∏–±–∫–∞ Fetch: ' + e, true));
                    
            } catch (e) {
                log('‚ùå –û—à–∏–±–∫–∞: ' + e, true);
            }
        }
        
        function testApiClient() {
            results.innerHTML = '<h3>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ ApiClient:</h3>';
            
            // –°–ø–æ—Å–æ–± 1: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
            const script = document.createElement('script');
            script.onload = function() {
                log('‚úÖ app.js –∑–∞–≥—Ä—É–∂–µ–Ω');
                
                setTimeout(() => {
                    if (typeof ApiClient !== 'undefined') {
                        log('‚úÖ ApiClient –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                        try {
                            const client = new ApiClient();
                            log('‚úÖ ApiClient —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                        } catch (e) {
                            log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è ApiClient: ' + e, true);
                        }
                    } else {
                        log('‚ùå ApiClient –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏', true);
                        log('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"');
                    }
                }, 1000);
            };
            
            script.onerror = function() {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ app.js', true);
            };
            
            script.src = '/app.js';
            document.head.appendChild(script);
        }
        
        function forceInit() {
            results.innerHTML = '<h3>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</h3>';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º app.js –∫–∞–∫ —Ç–µ–∫—Å—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Ä—É—á–Ω—É—é
            fetch('/app.js')
                .then(r => r.text())
                .then(code => {
                    log('‚úÖ app.js –ø–æ–ª—É—á–µ–Ω, —Ä–∞–∑–º–µ—Ä: ' + code.length + ' –±–∞–π—Ç');
                    
                    try {
                        // –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–¥
                        eval(code);
                        log('‚úÖ –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                        
                        if (typeof ApiClient !== 'undefined') {
                            log('‚úÖ ApiClient —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–µ–Ω!');
                            
                            // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
                            window.apiClient = new ApiClient();
                            log('‚úÖ window.apiClient —Å–æ–∑–¥–∞–Ω');
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
                            const functions = ['showTab', 'createTask', 'loadTasks'];
                            functions.forEach(fn => {
                                if (typeof window[fn] === 'function') {
                                    log('‚úÖ –§—É–Ω–∫—Ü–∏—è ' + fn + ' –¥–æ—Å—Ç—É–ø–Ω–∞');
                                } else {
                                    log('‚ùå –§—É–Ω–∫—Ü–∏—è ' + fn + ' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', true);
                                }
                            });
                            
                            log('\nüéâ Frontend –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å! –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∞
                            const btn = document.createElement('button');
                            btn.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é';
                            btn.onclick = () => window.location.href = '/';
                            btn.style.cssText = 'background: green; color: white; padding: 15px 30px; margin-top: 20px;';
                            results.appendChild(btn);
                            
                        } else {
                            log('‚ùå ApiClient –≤—Å–µ –µ—â–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω', true);
                        }
                        
                    } catch (e) {
                        log('‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞: ' + e, true);
                        console.error(e);
                    }
                })
                .catch(e => {
                    log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å app.js: ' + e, true);
                });
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            status.innerHTML = '<p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.</p>';
        };
    </script>
</body>
</html>