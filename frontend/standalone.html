<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Analyzer - Standalone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-tab.active { background-color: #dbeafe; color: #1d4ed8; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center justify-center w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-sm">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900">YouTube Analyzer</h1>
                        <p class="text-xs text-gray-500">Standalone Version</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <nav class="bg-white p-1 rounded-xl shadow-sm border border-gray-200">
            <div class="flex flex-wrap gap-1">
                <button class="nav-tab active px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showTab('tasks')">
                    üìã –ó–∞–¥–∞—á–∏
                </button>
                <button class="nav-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showTab('create')">
                    ‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                </button>
                <button class="nav-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showTab('videos')">
                    üé¨ –í–∏–¥–µ–æ
                </button>
                <button class="nav-tab px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="showTab('stats')">
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </button>
            </div>
        </nav>
    </div>

    <!-- Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
        <!-- Tasks Tab -->
        <div id="tasks-tab" class="tab-content active">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏</h2>
                <button onclick="loadTasks()" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <div id="tasks-list" class="space-y-4">
                    <div class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>

        <!-- Create Task Tab -->
        <div id="create-tab" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold mb-4">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</h2>
                <form onsubmit="createTask(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</label>
                        <textarea id="keywords" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                  placeholder="python tutorial&#10;web development&#10;react js">python tutorial
web development</textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ö–∞–Ω–∞–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea id="channels" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                  placeholder="https://youtube.com/@channel1"></textarea>
                    </div>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        ‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
                    </button>
                </form>
                <div id="create-result" class="mt-4"></div>
            </div>
        </div>

        <!-- Videos Tab -->
        <div id="videos-tab" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold mb-4">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ</h2>
                <button onclick="loadVideos()" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <div id="videos-list" class="space-y-4">
                    <div class="text-gray-500">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                </div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h2 class="text-xl font-semibold mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div id="stats-content" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-gray-500 col-span-full">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–æ–π API –∫–ª–∏–µ–Ω—Ç
        async function api(endpoint, options = {}) {
            try {
                const response = await fetch('/api' + endpoint, {
                    headers: {'Content-Type': 'application/json'},
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function showTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            if (tabName === 'stats') loadStats();
            if (tabName === 'tasks') loadTasks();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
        async function loadTasks() {
            const container = document.getElementById('tasks-list');
            container.innerHTML = '<div class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                const tasks = await api('/tasks/');
                
                if (tasks.length === 0) {
                    container.innerHTML = '<div class="text-gray-500">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>';
                    return;
                }
                
                container.innerHTML = tasks.map(task => `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">–ó–∞–¥–∞—á–∞ ${task.task_id.substring(0, 8)}</h3>
                            <span class="px-2 py-1 text-xs rounded-full ${
                                task.status === 'running' ? 'bg-green-100 text-green-800' :
                                task.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                task.status === 'error' ? 'bg-red-100 text-red-800' :
                                'bg-gray-100 text-gray-800'
                            }">${task.status}</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            –ü—Ä–æ–≥—Ä–µ—Å—Å: ${task.progress}/${task.total_items}
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${(task.progress/task.total_items*100)||0}%"></div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                container.innerHTML = `<div class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
        async function createTask(event) {
            event.preventDefault();
            
            const keywords = document.getElementById('keywords').value.split('\n').map(k => k.trim()).filter(k => k);
            const channels = document.getElementById('channels').value.split('\n').map(c => c.trim()).filter(c => c);
            const resultDiv = document.getElementById('create-result');
            
            if (keywords.length === 0 && channels.length === 0) {
                resultDiv.innerHTML = '<div class="text-red-500">–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ –∫–∞–Ω–∞–ª</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="text-blue-500">–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...</div>';
            
            try {
                const result = await api('/tasks/', {
                    method: 'POST',
                    body: JSON.stringify({
                        keywords: keywords,
                        channels: channels,
                        order_by: 'relevance',
                        max_videos_per_source: 20
                    })
                });
                
                resultDiv.innerHTML = `<div class="text-green-500">‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞! ID: ${result.task_id}</div>`;
                document.getElementById('keywords').value = '';
                document.getElementById('channels').value = '';
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∑–∞–¥–∞—á
                setTimeout(() => {
                    document.querySelector('.nav-tab').click();
                }, 1500);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-500">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
        async function loadVideos() {
            const container = document.getElementById('videos-list');
            container.innerHTML = '<div class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                const videos = await api('/data/videos?limit=20');
                
                if (videos.length === 0) {
                    container.innerHTML = '<div class="text-gray-500">–ù–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ</div>';
                    return;
                }
                
                container.innerHTML = videos.map(video => `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <h3 class="font-semibold mb-1">${video.title}</h3>
                        <p class="text-sm text-gray-600 mb-2">${video.channel_title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–Ω–∞–ª'}</p>
                        <div class="flex items-center gap-4 text-sm text-gray-500">
                            <span>üëÅÔ∏è ${formatNumber(video.views)}</span>
                            <span>üëç ${formatNumber(video.likes)}</span>
                            <span>üí¨ ${formatNumber(video.comments)}</span>
                            <span class="${video.engagement_rate > 5 ? 'text-green-600' : video.engagement_rate > 2 ? 'text-yellow-600' : 'text-red-600'}">
                                üìä ${video.engagement_rate?.toFixed(1) || 0}%
                            </span>
                        </div>
                        <a href="https://youtube.com/watch?v=${video.video_id}" target="_blank" 
                           class="inline-block mt-2 text-blue-600 hover:underline text-sm">
                            –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ YouTube ‚Üí
                        </a>
                    </div>
                `).join('');
                
            } catch (error) {
                container.innerHTML = `<div class="text-red-500">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            const container = document.getElementById('stats-content');
            
            try {
                const stats = await api('/data/stats');
                
                container.innerHTML = `
                    <div class="bg-blue-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-blue-600">${stats.total_videos}</div>
                        <div class="text-gray-600">–í–∏–¥–µ–æ</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-purple-600">${stats.total_channels}</div>
                        <div class="text-gray-600">–ö–∞–Ω–∞–ª–æ–≤</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-6 text-center">
                        <div class="text-3xl font-bold text-green-600">${stats.completed_tasks}</div>
                        <div class="text-gray-600">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á</div>
                    </div>
                `;
                
            } catch (error) {
                container.innerHTML = `<div class="text-red-500 col-span-full">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</div>`;
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
            loadStats();
        });
    </script>
</body>
</html>