<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Analyzer - Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">YouTube Analyzer - –û—Ç–ª–∞–¥–∫–∞</h1>
        
        <div id="status" class="space-y-4">
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-2">üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤</h2>
                <div id="script-status"></div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-2">üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h2>
                <div id="api-status"></div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-2">üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
                <div id="component-status"></div>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow">
                <h2 class="font-semibold mb-2">‚ùå –û—à–∏–±–∫–∏</h2>
                <div id="errors" class="text-red-600"></div>
            </div>
        </div>
        
        <div class="mt-8">
            <button onclick="loadMainPage()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            </button>
        </div>
    </div>

    <script>
        console.log('üöÄ Debug page loaded');
        
        const scriptStatus = document.getElementById('script-status');
        const apiStatus = document.getElementById('api-status');
        const componentStatus = document.getElementById('component-status');
        const errorsDiv = document.getElementById('errors');
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            console.error('Global error:', e);
            errorsDiv.innerHTML += `<div>‚ùå ${e.message} (${e.filename}:${e.lineno})</div>`;
        });
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç promise rejection
        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled rejection:', e);
            errorsDiv.innerHTML += `<div>‚ùå Promise rejection: ${e.reason}</div>`;
        });
        
        async function checkScripts() {
            scriptStatus.innerHTML = '<div>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤...</div>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ app.js
            try {
                const response = await fetch('/app.js');
                const content = await response.text();
                
                if (response.ok && content.includes('ApiClient')) {
                    scriptStatus.innerHTML += '<div>‚úÖ app.js –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç ApiClient</div>';
                    
                    // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å
                    const script = document.createElement('script');
                    script.src = '/app.js';
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                        setTimeout(() => reject(new Error('Timeout')), 5000);
                    });
                    
                    if (typeof window.ApiClient !== 'undefined') {
                        scriptStatus.innerHTML += '<div>‚úÖ ApiClient –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ</div>';
                    } else {
                        scriptStatus.innerHTML += '<div>‚ùå ApiClient –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
                    }
                } else {
                    scriptStatus.innerHTML += '<div>‚ùå app.js –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω</div>';
                }
            } catch (error) {
                scriptStatus.innerHTML += `<div>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ app.js: ${error.message}</div>`;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª–µ–π
            try {
                const styleResponse = await fetch('/style.css');
                if (styleResponse.ok) {
                    scriptStatus.innerHTML += '<div>‚úÖ style.css –¥–æ—Å—Ç—É–ø–µ–Ω</div>';
                }
            } catch (error) {
                scriptStatus.innerHTML += '<div>‚ùå style.css –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Lucide
            if (typeof lucide !== 'undefined') {
                scriptStatus.innerHTML += '<div>‚úÖ Lucide icons –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>';
            } else {
                scriptStatus.innerHTML += '<div>‚ö†Ô∏è Lucide icons –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</div>';
            }
        }
        
        async function checkAPI() {
            apiStatus.innerHTML = '<div>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ API...</div>';
            
            const endpoints = [
                '/api/tasks',
                '/api/config', 
                '/api/data/stats'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    
                    if (response.ok) {
                        apiStatus.innerHTML += `<div>‚úÖ ${endpoint} - OK</div>`;
                    } else {
                        apiStatus.innerHTML += `<div>‚ùå ${endpoint} - Error ${response.status}</div>`;
                    }
                } catch (error) {
                    apiStatus.innerHTML += `<div>‚ùå ${endpoint} - ${error.message}</div>`;
                }
            }
        }
        
        async function checkComponents() {
            componentStatus.innerHTML = '<div>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...</div>';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const testHTML = `
                <div id="test-container" style="display: none;">
                    <div id="alert"></div>
                    <div class="nav-tab" data-tab="test"></div>
                    <div id="task-form"></div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', testHTML);
            
            if (document.getElementById('alert')) {
                componentStatus.innerHTML += '<div>‚úÖ DOM —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</div>';
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –µ—Å–ª–∏ ApiClient –∑–∞–≥—Ä—É–∂–µ–Ω
            if (typeof window.ApiClient !== 'undefined') {
                try {
                    const client = new window.ApiClient();
                    componentStatus.innerHTML += '<div>‚úÖ ApiClient –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å</div>';
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤
                    if (typeof client.getTasks === 'function') {
                        componentStatus.innerHTML += '<div>‚úÖ ApiClient –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã</div>';
                    }
                } catch (error) {
                    componentStatus.innerHTML += `<div>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è ApiClient: ${error.message}</div>`;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
            const globalFunctions = ['showTab', 'createTask', 'loadTasks', 'loadVideos'];
            for (const func of globalFunctions) {
                if (typeof window[func] === 'function') {
                    componentStatus.innerHTML += `<div>‚úÖ –§—É–Ω–∫—Ü–∏—è ${func} –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>`;
                } else {
                    componentStatus.innerHTML += `<div>‚ùå –§—É–Ω–∫—Ü–∏—è ${func} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</div>`;
                }
            }
        }
        
        async function runChecks() {
            console.log('Starting checks...');
            await checkScripts();
            await checkAPI();
            await checkComponents();
            
            if (errorsDiv.innerHTML === '') {
                errorsDiv.innerHTML = '<div class="text-green-600">‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>';
            }
        }
        
        function loadMainPage() {
            window.location.href = '/';
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
        runChecks();
    </script>
</body>
</html>