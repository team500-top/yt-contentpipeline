<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>API Routes Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .endpoint { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { background: white; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ API —Ä–æ—É—Ç–æ–≤</h1>
    <button onclick="testAllEndpoints()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ endpoints</button>
    <div id="results"></div>

    <script>
        const endpoints = [
            // –ë–∞–∑–æ–≤—ã–µ
            { method: 'GET', path: '/health', name: 'Health Check' },
            { method: 'GET', path: '/api', name: 'API Info' },
            
            // Tasks - —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            { method: 'GET', path: '/api/tasks', name: 'Tasks List (–±–µ–∑ —Å–ª–µ—à–∞)' },
            { method: 'GET', path: '/api/tasks/', name: 'Tasks List (—Å–æ —Å–ª–µ—à–µ–º)' },
            { method: 'POST', path: '/api/tasks/', name: 'Create Task', 
              body: { keywords: ['test'], channels: [], order_by: 'relevance' } },
            
            // Config - —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã  
            { method: 'GET', path: '/api/config', name: 'Config (–±–µ–∑ —Å–ª–µ—à–∞)' },
            { method: 'GET', path: '/api/config/', name: 'Config (—Å–æ —Å–ª–µ—à–µ–º)' },
            
            // Data endpoints
            { method: 'GET', path: '/api/data/videos', name: 'Videos' },
            { method: 'GET', path: '/api/data/channels', name: 'Channels' },
            { method: 'GET', path: '/api/data/stats', name: 'Stats' },
            
            // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
            { method: 'GET', path: '/app.js', name: 'app.js', checkContent: true },
            { method: 'GET', path: '/style.css', name: 'style.css', checkContent: true }
        ];
        
        async function testEndpoint(endpoint) {
            const div = document.createElement('div');
            div.className = 'endpoint';
            
            try {
                const options = {
                    method: endpoint.method,
                    headers: {}
                };
                
                if (endpoint.body) {
                    options.headers['Content-Type'] = 'application/json';
                    options.body = JSON.stringify(endpoint.body);
                }
                
                const response = await fetch(endpoint.path, options);
                const contentType = response.headers.get('content-type') || '';
                
                let responseData;
                if (endpoint.checkContent || contentType.includes('text')) {
                    responseData = await response.text();
                } else {
                    responseData = await response.json();
                }
                
                if (response.ok) {
                    div.className += ' success';
                    div.innerHTML = `
                        <strong>‚úÖ ${endpoint.name}</strong><br>
                        ${endpoint.method} ${endpoint.path} ‚Üí ${response.status}<br>
                        Content-Type: ${contentType}
                        ${endpoint.checkContent ? `<br>–†–∞–∑–º–µ—Ä: ${responseData.length} –±–∞–π—Ç` : ''}
                        <pre>${endpoint.checkContent ? responseData.substring(0, 200) + '...' : JSON.stringify(responseData, null, 2)}</pre>
                    `;
                } else {
                    div.className += ' error';
                    div.innerHTML = `
                        <strong>‚ùå ${endpoint.name}</strong><br>
                        ${endpoint.method} ${endpoint.path} ‚Üí ${response.status}<br>
                        <pre>${JSON.stringify(responseData, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                div.className += ' error';
                div.innerHTML = `
                    <strong>‚ùå ${endpoint.name}</strong><br>
                    ${endpoint.method} ${endpoint.path}<br>
                    –û—à–∏–±–∫–∞: ${error.message}
                `;
            }
            
            return div;
        }
        
        async function testAllEndpoints() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...</p>';
            
            const divs = [];
            for (const endpoint of endpoints) {
                const div = await testEndpoint(endpoint);
                divs.push(div);
            }
            
            results.innerHTML = '';
            divs.forEach(div => results.appendChild(div));
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
            const problemDiv = document.createElement('div');
            problemDiv.className = 'endpoint';
            problemDiv.innerHTML = '<h3>üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º:</h3>';
            
            const tasksWorks = divs.some(d => d.textContent.includes('Tasks List') && d.className.includes('success'));
            const configWorks = divs.some(d => d.textContent.includes('Config') && d.className.includes('success'));
            
            if (!tasksWorks) {
                problemDiv.innerHTML += '<p>‚ùå API tasks –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ tasks_router –≤ main.py</p>';
            }
            if (!configWorks) {
                problemDiv.innerHTML += '<p>‚ùå API config –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ config_router –≤ main.py</p>';
            }
            
            results.appendChild(problemDiv);
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
        window.onload = () => testAllEndpoints();
    </script>
</body>
</html>