<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>YouTube Analyzer - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test { margin: 10px 0; padding: 15px; border-radius: 4px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #cfe2ff; border-color: #b6d4fe; }
        pre { margin: 5px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; overflow-x: auto; }
        h1 { color: #333; }
        .fix-button { margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .fix-button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß YouTube Analyzer - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç...</p>
        <hr>
        <div id="results"></div>
        
        <div id="diagnosis" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 4px; display: none;">
            <h3>üìä –î–∏–∞–≥–Ω–æ–∑:</h3>
            <div id="diagnosis-content"></div>
        </div>
        
        <div id="fix-section" style="display: none; margin-top: 20px;">
            <button class="fix-button" onclick="applyFix()">üî® –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
        </div>
    </div>
    
    <script>
        const tests = [
            { 
                name: 'üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞', 
                url: 'http://localhost:8000/health',
                critical: true
            },
            { 
                name: 'üì° API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å', 
                url: 'http://localhost:8000/api',
                critical: true
            },
            { 
                name: 'üìÑ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã - app.js', 
                url: 'http://localhost:8000/app.js',
                checkContent: true,
                expectedContent: 'ApiClient'
            },
            { 
                name: 'üé® –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã - style.css', 
                url: 'http://localhost:8000/style.css',
                checkContent: true,
                expectedContent: 'YouTube Analyzer'
            },
            { 
                name: 'üìã API Tasks', 
                url: 'http://localhost:8000/api/tasks',
                critical: false
            },
            { 
                name: '‚öôÔ∏è API Config', 
                url: 'http://localhost:8000/api/config',
                critical: false
            }
        ];
        
        const results = document.getElementById('results');
        const problems = [];
        
        async function runTests() {
            results.innerHTML = '<div class="test loading">‚è≥ –ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...</div>';
            await new Promise(resolve => setTimeout(resolve, 500));
            results.innerHTML = '';
            
            for (const test of tests) {
                const div = document.createElement('div');
                div.className = 'test loading';
                div.innerHTML = `‚è≥ ${test.name}: –ü—Ä–æ–≤–µ—Ä–∫–∞...`;
                results.appendChild(div);
                
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url);
                    const duration = Date.now() - startTime;
                    
                    let content = '';
                    if (test.checkContent) {
                        content = await response.text();
                    } else {
                        content = await response.json();
                    }
                    
                    if (response.ok) {
                        let isValid = true;
                        let validationMessage = '';
                        
                        if (test.checkContent && test.expectedContent) {
                            isValid = content.includes(test.expectedContent);
                            if (!isValid) {
                                validationMessage = ` (–ù–µ –Ω–∞–π–¥–µ–Ω –æ–∂–∏–¥–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: "${test.expectedContent}")`;
                                problems.push({
                                    test: test.name,
                                    issue: 'missing_content',
                                    url: test.url
                                });
                            }
                        }
                        
                        if (isValid) {
                            div.className = 'test success';
                            div.innerHTML = `
                                ‚úÖ <strong>${test.name}</strong>: OK (${response.status}) - ${duration}ms
                                <br><small>${test.url}</small>
                                ${test.checkContent ? `<pre>–†–∞–∑–º–µ—Ä: ${content.length} –±–∞–π—Ç</pre>` : 
                                  `<pre>${JSON.stringify(content, null, 2).substring(0, 200)}${JSON.stringify(content).length > 200 ? '...' : ''}</pre>`}
                            `;
                        } else {
                            div.className = 'test error';
                            div.innerHTML = `
                                ‚ùå <strong>${test.name}</strong>: –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º${validationMessage}
                                <br><small>${test.url}</small>
                            `;
                        }
                    } else {
                        div.className = 'test error';
                        div.innerHTML = `
                            ‚ùå <strong>${test.name}</strong>: Error ${response.status} - ${duration}ms
                            <br><small>${test.url}</small>
                            <pre>${JSON.stringify(content, null, 2)}</pre>
                        `;
                        
                        if (test.critical) {
                            problems.push({
                                test: test.name,
                                issue: 'http_error',
                                status: response.status,
                                url: test.url
                            });
                        }
                    }
                } catch (error) {
                    div.className = 'test error';
                    div.innerHTML = `
                        ‚ùå <strong>${test.name}</strong>: –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞
                        <br><small>${test.url}</small>
                        <pre>${error.message}</pre>
                    `;
                    
                    if (test.critical) {
                        problems.push({
                            test: test.name,
                            issue: 'network_error',
                            error: error.message,
                            url: test.url
                        });
                    }
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            showDiagnosis();
        }
        
        function showDiagnosis() {
            const diagnosisEl = document.getElementById('diagnosis');
            const diagnosisContent = document.getElementById('diagnosis-content');
            const fixSection = document.getElementById('fix-section');
            
            diagnosisEl.style.display = 'block';
            
            if (problems.length === 0) {
                diagnosisContent.innerHTML = `
                    <p style="color: green;">‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</p>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                    <ul>
                        <li>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)</li>
                        <li>–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏</li>
                        <li>–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ CMD –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å run.bat –∑–∞–Ω–æ–≤–æ)</li>
                    </ul>
                `;
            } else {
                let diagnosis = '<p style="color: red;">‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:</p><ul>';
                
                const hasServerError = problems.some(p => p.url.includes('/health') || p.url.includes('/api'));
                const hasStaticError = problems.some(p => p.url.includes('.js') || p.url.includes('.css'));
                
                if (hasServerError) {
                    diagnosis += '<li><strong>Backend —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç</strong> - FastAPI –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏</li>';
                }
                
                if (hasStaticError) {
                    diagnosis += '<li><strong>–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è</strong> - –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—É—Ç—è–º–∏ –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ñ–∞–π–ª–æ–≤</li>';
                }
                
                diagnosis += '</ul>';
                
                diagnosis += '<p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong></p><ol>';
                
                if (hasServerError) {
                    diagnosis += `
                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –æ–∫–Ω–µ CMD –Ω–µ—Ç –æ—à–∏–±–æ–∫ Python</li>
                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 8000 –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</li>
                        <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</li>
                    `;
                }
                
                if (hasStaticError) {
                    diagnosis += `
                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ frontend/app.js –∏ frontend/style.css</li>
                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ</li>
                    `;
                }
                
                diagnosis += '</ol>';
                
                diagnosisContent.innerHTML = diagnosis;
                fixSection.style.display = 'block';
            }
        }
        
        async function applyFix() {
            const fixButton = document.querySelector('.fix-button');
            fixButton.disabled = true;
            fixButton.textContent = '‚è≥ –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è...';
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            alert('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–∑–∞–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ CMD –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ run.bat)\n2. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)\n3. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ - —Å–º. –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ');
            
            fixButton.textContent = '‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã';
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        runTests();
        
        // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const retestBtn = document.createElement('button');
        retestBtn.textContent = 'üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É';
        retestBtn.style.cssText = 'margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer;';
        retestBtn.onclick = runTests;
        document.querySelector('.container').appendChild(retestBtn);
    </script>
</body>
</html>